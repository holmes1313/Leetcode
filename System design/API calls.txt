API with rate limiter
(1)incremental reading
(2)automatic retry

url = "https://apis.example.com/data"

param = {offset: 0, batch_size: 2000}
def fetch_data(url, param):
    response = requests.get(url, params=params)
    if response.status_code = 200:
        return response.json()
    elif response.status_code == 429:
        retry_after = response.headers.get("retry-after", 1)
        time.sleep(retry_after)
        return fetch_data(url, params)
    else:
        print(response.status_code)
        return None


def fetch_all_data(url):
    all_data = []
    offset = 0
    batch_size = 2000
    while True:
        param["offset"] = offset
        data = fetch_data(url, param)

        if data:
            all_data.extend(data)
        else:
            print("no more data")
            break
        
        time.sleep(1)

        offset += batch_size

    return all_data
            

        